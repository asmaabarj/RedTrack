<div class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm z-50 flex items-center justify-center overflow-hidden">
  <div class="relative mx-auto p-8 w-full max-w-2xl shadow-2xl rounded-2xl bg-white max-h-[90vh] overflow-y-auto">
    <!-- Header - Make it sticky -->
    <div class="sticky top-0 bg-white pb-6 z-10">
      <h3 class="text-2xl font-bold text-gray-900">Créer une nouvelle étape</h3>
      <p class="text-sm text-gray-500 mt-1">Remplissez les informations ci-dessous pour créer une nouvelle étape</p>
    </div>

    <form [formGroup]="etapeForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <!-- Titre Field -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Titre de l'étape</label>
        <div class="relative">
          <i class="fas fa-tasks absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
          <input type="text" formControlName="titre"
                 class="pl-10 w-full rounded-lg border border-gray-300 bg-white py-3 px-4 text-sm font-medium placeholder:text-gray-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                 [ngClass]="{'border-red-500 focus:border-red-500 focus:ring-red-500': etapeForm.get('titre')?.invalid && etapeForm.get('titre')?.touched}"
                 placeholder="Entrez le titre de l'étape">
          <p class="mt-1 text-sm text-red-500" *ngIf="etapeForm.get('titre')?.invalid && etapeForm.get('titre')?.touched">
            {{ getErrorMessage('titre') }}
          </p>
        </div>
      </div>

      <!-- Description Field -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
        <div class="relative">
          <textarea formControlName="description" rows="4"
                    class="w-full rounded-lg border border-gray-300 bg-white py-3 px-4 text-sm font-medium placeholder:text-gray-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                    [ngClass]="{'border-red-500 focus:border-red-500 focus:ring-red-500': etapeForm.get('description')?.invalid && etapeForm.get('description')?.touched}"
                    placeholder="Décrivez l'étape en détail"></textarea>
          <p class="mt-1 text-sm text-red-500" *ngIf="etapeForm.get('description')?.invalid && etapeForm.get('description')?.touched">
            {{ getErrorMessage('description') }}
          </p>
        </div>
      </div>

      <!-- Deadline Field -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Date limite</label>
        <div class="relative">
          <i class="far fa-calendar absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
          <input type="date" formControlName="deadline" [min]="today"
                 class="pl-10 w-full rounded-lg border border-gray-300 bg-white py-3 px-4 text-sm font-medium focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                 [ngClass]="{'border-red-500 focus:border-red-500 focus:ring-red-500': etapeForm.get('deadline')?.invalid && etapeForm.get('deadline')?.touched}">
          <p class="mt-1 text-sm text-red-500" *ngIf="etapeForm.get('deadline')?.invalid && etapeForm.get('deadline')?.touched">
            {{ getErrorMessage('deadline') }}
          </p>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex items-center justify-end space-x-4 pt-4">
        <button type="button"
                (click)="closeModal.emit()"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
          Annuler
        </button>
        <button type="submit"
                class="px-4 py-2 bg-gradient-to-r from-red-600 to-red-800 
                hover:from-red-700 hover:to-red-900 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed">
          Créer l'étape
        </button>
      </div>
    </form>
  </div>
</div>
